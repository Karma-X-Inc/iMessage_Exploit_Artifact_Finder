#!/usr/bin/env python3
"""
Tool:    deleted_attachments.py
Project: iMessage_Exploit_Artifact_Finder

Author:  Karma-X Inc.

This script enumerates all directories and subdirectories within iMessages 
Attachments folder and lists any directory that doesn't have a file in it. 
The user is prompted to enter their username to construct the path to the 
target folder.

Usage:
    python3 deleted_attachments.py
"""

import os

def list_empty_directories(root_dir):
    empty_dirs = []
    for dirpath, dirnames, filenames in os.walk(root_dir):
        if not dirnames and not filenames:
            empty_dirs.append(dirpath)
        elif not filenames:
            has_files = False
            for subdirname in dirnames:
                subdir_path = os.path.join(dirpath, subdirname)
                if any(os.scandir(subdir_path)):
                    has_files = True
                    break
            if not has_files:
                empty_dirs.append(dirpath)
    return empty_dirs

def main():
    username = input("Please enter your username: ")
    root_dir = f"/Users/{username}/Library/Messages/Attachments"
    if not os.path.exists(root_dir):
        print(f"The directory {root_dir} does not exist.")
        return
    
    empty_dirs = list_empty_directories(root_dir)
    if empty_dirs:
        print("Empty directories:")
        for empty_dir in empty_dirs:
            print(empty_dir)
    else:
        print("No empty directories found.")

if __name__ == "__main__":
    main()
